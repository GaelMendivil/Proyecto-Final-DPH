@model dynamic

@{
    ViewData["Title"] = "Pokedex Game";
}

<partial name="_LogoutBall" />

<style>

.title-container {
    position: relative;
    text-align: center;
    padding-top: 10vh;
    width: 100%;
    height: 25vh;
}

.pokemon-title {
    font-weight: normal;
    margin: 0;
    position: absolute;
    width: 100%;

    top: 100%;
    left: 73%;
    transform: translate(-50%, -50%);

    display: flex;
    flex-direction: column;
    align-items: center;
    line-height: 0.9;
}

.pokemon-title.hollow {
    font-family: 'Pokemon Hollow', sans-serif;
    color: #2a75bb;
    -webkit-text-stroke: 15px #003a70;

    text-shadow:
        3px 0 0 #003a70,
        -3px 0 0 #003a70,
        0 3px 0 #003a70,
        0 -3px 0 #003a70,
        2px 2px 0 #003a70,
        -2px -2px 0 #003a70,
        2px -2px 0 #003a70,
        -2px 2px 0 #003a70;

    font-size: 7vw;
}

.pokemon-title.solid {
    font-family: 'Pokemon Solid', sans-serif;
    color: #FFCB05;
    font-size: 7vw;
}

.back-button {
    position: fixed;
    top: 12px;
    left: 12px;
    z-index: 1400;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 56px;
    height: 44px;
    border-radius: 10px;
    background: linear-gradient(180deg,#1d5fe0,#124aa8);
    color: #fff;
    text-decoration: none;
    font-size: 26px;
    font-weight: 800;
    border: 3px solid rgba(10,40,120,0.9);
    box-shadow: 0 6px 14px rgba(10,40,120,0.28);
    transition: transform .12s ease, box-shadow .12s ease;
}
.back-button:hover, .back-button:focus {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 8px 18px rgba(10,40,120,0.36);
}

body {
    background-color: #add8e6;
    background-image: url('/images/PokedexBG.png');
    background-repeat: no-repeat;
    background-size: cover;
    background-position: center;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    font-family: Arial, sans-serif;
    gap: 30px; 
    flex-wrap: wrap;
}

.box {
    background-color: rgba(255, 255, 255, 0.9);
    padding: 25px;
    border-radius: 20px;
    min-height: 250px;
    text-align: center;
}

.box.description-box {
    width: 460px;
    margin-top: 50px;
    margin-left: -55px;
    font-size: 20px;
    background-color: transparent;
}

.box.guess-box {
    width: 360px;
    margin-top: 53px;
    margin-left: 250px;
    min-height: 150px;
    padding: 20px;
    font-size: 19px;
    background-color: transparent;
}

.description-box h2,
.guess-box h2 {
    margin-bottom: 15px;
}

.description {
    font-style: italic;
    color: #333;
    margin-bottom: 10px;
}

.message {
    font-weight: bold;
    margin-bottom: 10px;
    color: #f04e30;
}

.pokemon-type {
    font-weight: bold;
    text-transform: capitalize;
    margin-bottom: 10px;
}

.pokemon-sprite img {
    max-width: 150px;
    margin-top: 10px;
}

.guess-box input[type="text"] {
    padding: 10px;
    width: 80%;
    border-radius: 10px;
    border: 1px solid #ccc;
    margin-bottom: 15px;
}

.guess-box button {
    padding: 10px 20px;
    border-radius: 10px;
    border: none;
    background-color: #f04e30;
    color: white;
    font-weight: bold;
    cursor: pointer;
    width: 80%;
}

.guess-box button:hover {
    background-color: #d03d25;
}

.attempts {
    margin-top: 15px;
    font-weight: bold;
}

</style>

<a asp-controller="Games" asp-action="Index" class="back-button" title="Volver a Games" aria-label="Volver a Games">
    &#8592;
</a>

<div class="title-container">
    <h1 class="pokemon-title hollow">
        <span>Who's That</span>
        <span>Pokémon?</span>
    </h1>
    <h1 class="pokemon-title solid">
        <span>Who's That</span>
        <span>Pokémon?</span>
    </h1>
</div>

<div class="box description-box">
    <h2>Descripción y Pistas</h2>

    @if(ViewBag.Description != null)
    {
        <div class="description">@ViewBag.Description</div>
    }

    @if(ViewBag.Message != null)
    {
        <div class="message">@ViewBag.Message</div>
    }

    @if(ViewBag.ShowType == true && ViewBag.Type != null)
    {
        <div class="pokemon-type">Tipo: @ViewBag.Type</div>
    }

    @if(ViewBag.Sprite != null)
    {
        <div class="pokemon-sprite">
            <img src="@ViewBag.Sprite" alt="Pokemon Sprite" />
        </div>
    }

    <div class="attempts">
        Intentos: @ViewBag.Attempts / 6
    </div>
</div>

<div class="box guess-box">
    <h2>Adivina el Pokémon</h2>
    <form asp-action="Guess" asp-controller="PokedexGame" method="post">
        <input type="text" name="guess" id="guessBox" placeholder="Inserta un nombre..." required />
        <button type="submit">Adivinar</button>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" />


<script>
    (function($){
        $(function() {
            const url = '@Url.Action("SearchPokemon", "PokedexGame")';

            function normalizeItem(item){
                return {
                    label: item.name || item.Name || item.label || "",
                    value: item.name || item.Name || item.value || "",
                    image: item.imageUrl || item.ImageUrl || item.image || ""
                };
            }

            $("#guessBox").autocomplete({
                source: function(request, response) {
                    console.log("Autocomplete request:", request.term);
                    $.ajax({
                        url: url,
                        type: 'GET',
                        data: { term: request.term },
                        dataType: 'json',
                        success: function(data) {
                            console.log("Autocomplete response:", data);
                            if (!Array.isArray(data)) {
                                response([]);
                                return;
                            }
                            const items = data.map(normalizeItem).slice(0, 10);
                            response(items);
                        },
                        error: function(xhr, status, err) {
                            console.error("Autocomplete AJAX error:", status, err, xhr.responseText);
                            response([]);
                        }
                    });
                },
                minLength: 2,
                focus: function(event, ui) {
                    event.preventDefault();
                    $("#guessBox").val(ui.item.value);
                },
                select: function(event, ui) {
                    $("#guessBox").val(ui.item.value);
                    return false;
                }
            })
            .autocomplete("instance")._renderItem = function(ul, item) {
                const $li = $("<li>");
                const $wrap = $("<div>").addClass("ui-menu-item-wrapper");
                const $img = $("<img>")
                    .attr("src", item.image || "/images/placeholder.png")
                    .attr("alt", item.value)
                    .css({ width: "40px", height: "40px" });
                const $text = $("<span>").text(item.label);
                $wrap.append($img).append($text);
                $li.append($wrap);
                return $li.appendTo(ul);
            };
        });
    })(jQuery);
</script>

